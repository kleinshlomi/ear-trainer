<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<title>אימון אוזן</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 20px;
}

button {
  font-size: 18px;
  padding: 10px 16px;
  margin: 6px;
}

#status {
  margin-top: 12px;
  font-weight: bold;
}

#bigAnswer {
  margin-top: 20px;
  font-size: 48px;
  font-weight: bold;
  text-align: center;
}

.resultBox {
  margin-top: 16px;
  padding: 12px;
  border: 1px solid #999;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.mark {
  font-size: 28px;
}
.ok { color: green; }
.bad { color: red; }
</style>
</head>

<body>

<h2>אימון אוזן – טרצה גדולה / קטנה</h2>

<button id="play">נגן רנדומלי</button>
<button id="replay">נגן שוב (R)</button>

<br>

<button id="major" disabled>מז'ור (F / M)</button>
<button id="minor" disabled>מינור (D / N)</button>

<div id="status">מוכן</div>

<div class="resultBox">
  <div>
    ענית:
    <span id="userText">—</span>
  </div>
  <div class="mark" id="mark">—</div>
  <div>
    נכון:
    <span id="correctText">—</span>
  </div>
</div>

<div id="bigAnswer"></div>

<script>
let ctx = null;
function audio() {
  if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
  if (ctx.state === "suspended") ctx.resume();
  return ctx;
}

function freq(m) {
  return 440 * Math.pow(2, (m - 69) / 12);
}

function play(m1, m2) {
  const c = audio();
  const t = c.currentTime + 0.03;

  [m1, m2].forEach(m => {
    const o = c.createOscillator();
    const g = c.createGain();
    o.frequency.value = freq(m);
    g.gain.value = 0.15;
    o.connect(g).connect(c.destination);
    o.start(t);
    o.stop(t + 0.8);
  });
}

let root = null;
let isMajor = null;

function newRound() {
  root = 48 + Math.floor(Math.random() * 24);
  isMajor = Math.random() < 0.5;

  document.getElementById("major").disabled = false;
  document.getElementById("minor").disabled = false;

  clearResult();
  play(root, root + (isMajor ? 4 : 3));
}

function replay() {
  if (root === null) newRound();
  else play(root, root + (isMajor ? 4 : 3));
}

function answer(userMajor) {
  const correct = userMajor === isMajor;

  document.getElementById("userText").textContent = userMajor ? "מז'ור" : "מינור";
  document.getElementById("correctText").textContent = isMajor ? "מז'ור" : "מינור";

  const mark = document.getElementById("mark");
  mark.textContent = correct ? "✅" : "❌";
  mark.className = "mark " + (correct ? "ok" : "bad");

  document.getElementById("bigAnswer").textContent =
    isMajor ? "מז'ור" : "מינור";

  document.getElementById("major").disabled = true;
  document.getElementById("minor").disabled = true;
}

function clearResult() {
  document.getElementById("userText").textContent = "—";
  document.getElementById("correctText").textContent = "—";
  document.getElementById("mark").textContent = "—";
  document.getElementById("bigAnswer").textContent = "";
}

document.getElementById("play").onclick = newRound;
document.getElementById("replay").onclick = replay;
document.getElementById("major").onclick = () => answer(true);
document.getElementById("minor").onclick = () => answer(false);

window.addEventListener("keydown", e => {
  if (e.metaKey || e.ctrlKey || e.altKey) return;

  if (e.code === "Space") { e.preventDefault(); newRound(); }
  if (e.code === "KeyR") { e.preventDefault(); replay(); }

  if (e.code === "KeyF" || e.code === "KeyM") {
    if (!document.getElementById("major").disabled) answer(true);
  }
  if (e.code === "KeyD" || e.code === "KeyN") {
    if (!document.getElementById("minor").disabled) answer(false);
  }
});
</script>

</body>
</html>